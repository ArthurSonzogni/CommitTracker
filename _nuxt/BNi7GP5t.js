import{_ as ye}from"./K_zvSPJA.js";import{_ as xe}from"./CH0ThVOt.js";import{s as E,t as te}from"./DkrfxnvH.js";import{B as be,a4 as he,f as le,K as _e,S as ne,L as ke,h as q,A as we,i as se,D as Ve,r as F,o as B,c as $,b as v,w as x,j as y,v as A,F as Me,k as Ie,t as Se,d as S,p as H,l as Q,q as Ae,g as qe,a as N,a5 as je}from"./BJdbIX9c.js";import{d as ae}from"./rlX7cRMw.js";import{f as re}from"./D2nGpDRe.js";import{l as Oe}from"./ntdiYfc-.js";import{l as Ue}from"./E4HCz5LM.js";import{i as oe}from"./C5X8qJ2i.js";import{_ as Be}from"./DlAUqK2U.js";import"./FOedhIC0.js";import"./yHBgcFlJ.js";import"./C7cJQd6b.js";function ue(c,h,w){c=+c,h=+h,w=(s=arguments.length)<2?(h=c,c=0,1):s<3?1:+w;for(var t=-1,s=Math.max(0,Math.ceil((h-c)/w))|0,_=new Array(s);++t<s;)_[t]=c+t*w;return _}function ie(){var c=be().unknown(void 0),h=c.domain,w=c.range,t=0,s=1,_,U,k=!1,V=0,n=0,M=.5;delete c.unknown;function p(){var i=h().length,j=s<t,O=j?s:t,C=j?t:s;_=(C-O)/Math.max(1,i-V+n*2),k&&(_=Math.floor(_)),O+=(C-O-_*(i-V))*M,U=_*(1-V),k&&(O=Math.round(O),U=Math.round(U));var f=ue(i).map(function(G){return O+_*G});return w(j?f.reverse():f)}return c.domain=function(i){return arguments.length?(h(i),p()):h()},c.range=function(i){return arguments.length?([t,s]=i,t=+t,s=+s,p()):[t,s]},c.rangeRound=function(i){return[t,s]=i,t=+t,s=+s,k=!0,p()},c.bandwidth=function(){return U},c.step=function(){return _},c.round=function(i){return arguments.length?(k=!!i,p()):k},c.padding=function(i){return arguments.length?(V=Math.min(1,n=+i),p()):V},c.paddingInner=function(i){return arguments.length?(V=Math.min(1,i),p()):V},c.paddingOuter=function(i){return arguments.length?(n=+i,p()):n},c.align=function(i){return arguments.length?(M=Math.max(0,Math.min(1,i)),p()):M},c.copy=function(){return ie(h(),[t,s]).round(k).paddingInner(V).paddingOuter(n).align(M)},he.apply(p(),arguments)}const Ce=["value"],P=100,Re=le({__name:"Leaderboard",props:_e({type:{type:String,default:"commit"},repositories:{type:Array[String],default:()=>["chromium"]},grouping:{type:String,default:"yearly"},kind:{type:String,default:"author"}},{timeIndex:{},timeIndexModifiers:{}}),emits:["update:timeIndex"],setup(c){const{$usersInfo:h}=ne(),{$color:w}=ne();let t=ke(c,"timeIndex");const s=c,_=q(null),U=q(null),k=q(null),V=q(null),n=P*50;q("instant");const M=q([]),p=q(!1),i=()=>{var u;return((u=_.value)==null?void 0:u.clientWidth)||800};we(()=>{switch(s.grouping){case"forever":return"Forever";case"yearly":return"Year";case"decennial":return"Decade";case"quarterly":return"Quarter";case"monthly":return"Month"}return"N/A"});const j=u=>{const e={};for(const r of u)Object.entries(r).forEach(([a,o])=>{e[a]||(e[a]={}),Object.entries(o).forEach(([l,d])=>{var m;(m=e[a])[l]||(m[l]=0),e[a][l]+=d})});return e},O=u=>{const e=[],r=Object.keys(u),a=new Set;for(const o of r)for(const l of Object.keys(u[o]))a.add(l);M.value=Array.from(a).sort((o,l)=>o<l?1:-1),t.value>=M.value.length&&(t.value=M.value.length-1);for(const o of M.value){const l={date:o,users:[]};for(const d of r)u[d][o]&&l.users.push([d,u[d][o]]);l.users.sort((d,m)=>m[1]-d[1]),l.users.splice(P*2),e.push(l)}return e},C=async()=>{p.value=!1;const u=await Promise.all(s.repositories.map(l=>h(l,s.type,s.grouping,s.kind))),e=j(u),r=O(e);r.sort((l,d)=>d.date>l.date?-1:1);const a=te().duration(500),o=Math.min(Math.max(t.value,0),r.length-1);t.value!=o&&(t.value=o),Z(r[r.length-t.value-1],a)},f=u=>{const e=u.append("g");return(r,a)=>{const o=ae(r).ticks(i()/100).tickSizeOuter(0).tickSizeInner(-n+100).tickFormat(l=>re(".2s")(l).replace("G","B"));e.transition(a).call(o),e.select(".tick:first-of-type text").remove(),e.selectAll(".tick:not(:first-of-type) line").attr("stroke","white"),e.select(".domain").remove(),e.attr("opacity",.2)}},G=u=>{const e=u.append("g").attr("transform","translate(0, 30)");return(r,a)=>{const o=ae(r).ticks(i()/100);e.transition(a).call(o)}},de=u=>{const e=u.append("g");return(r,a,o,l)=>{const d=o.users.length,m=b=>b.transition(l).attr("transform",(g,L)=>`translate(0, ${a(L)})`).attr("opacity",1),I=b=>b.transition(l).attr("width",g=>r(g[1])-r(0)),R=b=>b.transition(l).attr("x",g=>r(g[1])+(r(g[1])<80?7:-7)).attr("text-anchor",g=>r(g[1])<80?"start":"end").text(g=>g[0]),T=b=>b.transition(l).attr("x",g=>r(g[1])+(r(g[1])<80?7:-7)).attr("text-anchor",g=>r(g[1])<80?"start":"end").textTween(function(g){const L=g[1];this._current||(this._current=0);const z=oe(this._current,L);return this._current=L,W=>{const D=Math.round(z(W));return D<100?Math.round(D):re(".3s")(D)}}),ee=b=>b.transition(l).textTween(function(g,L){const z=L+1;this._current||(this._current=0);const W=oe(this._current,z);return this._current=z,D=>Math.round(W(D))});e.selectAll("g").data(o.users.slice(0,P),b=>b[0]).join(b=>{const g=b.append("g");return g.attr("transform",`translate(1, ${a.bandwidth()*d})`).attr("opacity",0).call(m),g.append("rect").attr("fill",ve=>w(ve[0])).attr("opacity",.5).attr("x",r(0)).attr("height",a.bandwidth()).call(I),g.append("text").classed("index",!0).attr("fill","black").attr("dy","0.35em").attr("dx",0).attr("dy",a.bandwidth()/2).attr("alignment-baseline","middle").call(ee),g.append("text").classed("name",!0).attr("fill","black").attr("dy","0.35em").attr("dx",5).attr("y",10).call(R),g.append("text").classed("commit",!0).attr("fill","gray").attr("dy","0.35em").attr("dx",5).attr("y",30).text(0).call(T),g},b=>(b.call(m),b.select("rect").call(I),b.select(".index").call(ee),b.select(".name").call(R),b.select(".commit").call(T),b),b=>{const g=b;return b.transition(l).attr("transform",`translate(1, ${a.bandwidth()*d})`).attr("opacity",0).remove(),g})}},me=(u,e=10)=>{const r=[];for(let a=0;a<u.length-1;a++){r.push(u[a]);const o={},l={};for(const[m,I]of u[a].users)o[m]=I;for(const[m,I]of u[a+1].users)l[m]=I;const d=new Set([...Object.keys(o),...Object.keys(l)]);for(let m=1;m<e;m++){const I=[];for(const R of d)I.push([R,(e-m)/e*(o[R]||0)+(0+m)/e*(l[R]||0)]);I.sort((R,T)=>T[1]-R[1]),r.push({date:u[a].date,users:I})}}return r.push(u[u.length-1]),r},ce=u=>{const e={};for(const r of u){for(const[a,o]of r.users)e[a]||(e[a]=0),e[a]+=o;r.users=[];for(const[a,o]of Object.entries(e))r.users.push([a,o]);r.users.sort((a,o)=>o[1]-a[1])}},Y=async(u=!1)=>{if(p.value){p.value=!1;return}const e=await Promise.all(s.repositories.map(m=>h(m,s.type,s.grouping,s.kind))),r=j(e),a=O(r);a.sort((m,I)=>m.date>I.date?-1:1),a.length=Math.min(a.length,Math.max(2,t.value+1)),a.sort((m,I)=>m.date<I.date?-1:1),u&&ce(a);let o=0;const l=5,d=me(a,l);for(o*=l,p.value=!0;o<d.length-1&&p.value;){o++;const m=te().duration(2e3/l).ease(Oe);Z(d[o],m),await m.end()}p.value=!1},pe=()=>{p.value=!1},ge=()=>{t.value=Math.min(t.value+1,M.value.length-1)},fe=()=>{t.value=Math.max(t.value-1,0)};let K=null,J=null,X=null;const Z=(u,e)=>{if(!u)return;const r=d=>d.attr("x",i()-10).attr("y",48).transition(e).text(m=>m);E(V.value).selectAll("text").data([u.date],d=>d).join(d=>{const m=d.append("text");return m.text(I=>I).attr("text-anchor","end").attr("transform","translate(0, 32)").attr("opacity",0).attr("font-size","2em"),m.transition(e).attr("transform","translate(0, 0)").attr("opacity",1),r(m)},d=>r(d.transition(e)),d=>d.transition(e).attr("transform","translate(0, -32)").attr("opacity",0).remove());const a=Math.max(...u.users.map(d=>d[1])),o=Ue().domain([0,a]).range([25,i()-10]),l=ie().domain(ue(P+1)).range([0,n-60]).padding(.1);K(o,l,u,e),J(o,e),X(o,e)};return window.addEventListener("resize",C),se(s,C),Ve(()=>{K=de(E(U.value)),J=f(E(U.value)),X=G(E(k.value)),C()}),(u,e)=>{const r=F("b-field"),a=F("b-select"),o=F("b-button");return B(),$("div",{ref_key:"container",ref:_,align:"center"},[v(r,{grouped:"","group-multiline":"",label:"time"},{default:x(()=>[v(r),v(r,null,{default:x(()=>[v(a,{modelValue:y(t),"onUpdate:modelValue":e[0]||(e[0]=l=>A(t)?t.value=l:t=l)},{default:x(()=>[(B(!0),$(Me,null,Ie(y(M),(l,d)=>(B(),$("option",{key:d,value:d},Se(l),9,Ce))),128))]),_:1},8,["modelValue"])]),_:1}),v(r,{grouped:""},{default:x(()=>[v(o,{onClick:ge,disabled:y(t)==y(M).length-1},{default:x(()=>e[3]||(e[3]=[S(" Previous ")])),_:1},8,["disabled"]),v(o,{onClick:fe,disabled:y(t)==0},{default:x(()=>e[4]||(e[4]=[S(" Next ")])),_:1},8,["disabled"])]),_:1}),!y(p)&&c.grouping!="forever"&&y(t)>0?(B(),H(r,{key:0},{default:x(()=>[v(o,{onClick:e[1]||(e[1]=l=>Y(!1)),class:"is-success"},{default:x(()=>e[5]||(e[5]=[S(" Animate ")])),_:1})]),_:1})):Q("",!0),!y(p)&&c.grouping!="forever"&&y(t)>0?(B(),H(r,{key:1},{default:x(()=>[v(o,{onClick:e[2]||(e[2]=l=>Y(!0)),class:"is-warning"},{default:x(()=>e[6]||(e[6]=[S(" Animate with accumulation ")])),_:1})]),_:1})):Q("",!0),y(p)?(B(),H(r,{key:2},{default:x(()=>[v(o,{onClick:pe,class:"is-danger"},{default:x(()=>e[7]||(e[7]=[S(" Stop ")])),_:1})]),_:1})):Q("",!0)]),_:1}),(B(),$("svg",{ref_key:"svg_axis",ref:k,width:"100%",height:31,class:"sticky-top"},null,512)),(B(),$("svg",{ref_key:"svg",ref:U,width:"100%",height:n},null,512)),(B(),$("svg",{ref_key:"svg_title",ref:V,width:"100%",height:80,class:"sticky-bottom"},null,512))],512)}}}),Le=Be(Re,[["__scopeId","data-v-0439a97f"]]),Ne={class:"section"},$e={class:"container"},Xe=le({__name:"leaderboard",setup(c){const h=q(["chromium"]),w=q("commit"),t=q("yearly"),s=q("author"),_=q(0),U=Ae(),k=qe();return k.query.repositories&&(h.value=k.query.repositories.split(",")),k.query.type&&(w.value=k.query.type),k.query.grouping&&(t.value=k.query.grouping),k.query.kind&&(s.value=k.query.kind),k.query.timeIndex&&(_.value=parseInt(k.query.timeIndex)),se([w,h,t,s,_],(V,n)=>{if(V[0]!=n[0]&&V[0]!="commit"){const M=new je;let p="";switch(V[0]){case"lines":p=`
          <div class="has-text-left">
            <strong>Value</strong>: <code>Sum(addition+deletion)</code>
            <br>
            <strong>Warning</strong>: Biased around large scale refactoring and
            large addition/deletion.
          </div>
        `;break;case"added_lines":p=`
          <div class="has-text-left">
            <strong>Value</strong>: <code>Sum(max(0, addition - deletion))</code>
            <br>
            <strong>Warning</strong>: Biased around large scale refactoring and
            large addition.
          </div>
        `;break;case"deleted_lines":p=`
          <div class="has-text-left">
            <strong>Value</strong>: <code>Sum(max(0, deletion - addition))</code>
            <br>
            <strong>Warning</strong>: Biased around large scale refactoring and
            large deletion.
          </div>
        `;break}M.open({message:p,type:"is-warning",position:"is-bottom",duration:5e3,pauseOnHover:!0,queue:!0})}U.replace({query:{type:w.value=="commit"?void 0:w.value,repositories:h.value.join(",")=="chromium"?void 0:h.value.join(","),grouping:t.value=="yearly"?void 0:t.value,kind:s.value=="author"?void 0:s.value,timeIndex:_.value==0?void 0:_.value.toString()}})}),(V,n)=>{const M=ye,p=xe,i=F("b-radio-button"),j=F("b-field"),O=F("b-select"),C=Le;return B(),$("div",null,[v(M),N("section",Ne,[N("div",$e,[n[20]||(n[20]=N("h1",{class:"title"},"Leaderboard",-1)),v(p,{modelValue:y(h),"onUpdate:modelValue":n[0]||(n[0]=f=>A(h)?h.value=f:null),size:"medium",allowMultiple:!0,allowAll:!0},null,8,["modelValue"]),v(j,{grouped:"","group-multiline":""},{default:x(()=>[v(j,{label:"As:"},{default:x(()=>[v(i,{name:"kind",modelValue:y(s),"onUpdate:modelValue":n[1]||(n[1]=f=>A(s)?s.value=f:null),"native-value":"author"},{default:x(()=>n[11]||(n[11]=[S(" author ")])),_:1},8,["modelValue"]),v(i,{name:"kind",modelValue:y(s),"onUpdate:modelValue":n[2]||(n[2]=f=>A(s)?s.value=f:null),"native-value":"review"},{default:x(()=>n[12]||(n[12]=[S(" Review ")])),_:1},8,["modelValue"]),v(i,{name:"kind",modelValue:y(s),"onUpdate:modelValue":n[3]||(n[3]=f=>A(s)?s.value=f:null),"native-value":"both"},{default:x(()=>n[13]||(n[13]=[S(" both ")])),_:1},8,["modelValue"])]),_:1}),v(j,{label:"Grouping:"},{default:x(()=>[v(i,{name:"grouping",modelValue:y(t),"onUpdate:modelValue":n[4]||(n[4]=f=>A(t)?t.value=f:null),"native-value":"forever"},{default:x(()=>n[14]||(n[14]=[S(" Forever ")])),_:1},8,["modelValue"]),v(i,{name:"grouping",modelValue:y(t),"onUpdate:modelValue":n[5]||(n[5]=f=>A(t)?t.value=f:null),"native-value":"decennial"},{default:x(()=>n[15]||(n[15]=[S(" Decennial ")])),_:1},8,["modelValue"]),v(i,{name:"grouping",modelValue:y(t),"onUpdate:modelValue":n[6]||(n[6]=f=>A(t)?t.value=f:null),"native-value":"yearly"},{default:x(()=>n[16]||(n[16]=[S(" Yearly ")])),_:1},8,["modelValue"]),v(i,{name:"grouping",modelValue:y(t),"onUpdate:modelValue":n[7]||(n[7]=f=>A(t)?t.value=f:null),"native-value":"quarterly"},{default:x(()=>n[17]||(n[17]=[S(" Quarterly ")])),_:1},8,["modelValue"]),v(i,{name:"grouping",modelValue:y(t),"onUpdate:modelValue":n[8]||(n[8]=f=>A(t)?t.value=f:null),"native-value":"monthly"},{default:x(()=>n[18]||(n[18]=[S(" Monthly ")])),_:1},8,["modelValue"])]),_:1}),v(j,{label:"type"},{default:x(()=>[v(O,{modelValue:y(w),"onUpdate:modelValue":n[9]||(n[9]=f=>A(w)?w.value=f:null)},{default:x(()=>n[19]||(n[19]=[N("option",{value:"commit"},"Commits",-1),N("option",{value:"lines"},"Lines",-1),N("option",{value:"added_lines"},"Additions",-1),N("option",{value:"deleted_lines"},"Deletions",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1}),v(C,{repositories:y(h),type:y(w),grouping:y(t),kind:y(s),timeIndex:y(_),"onUpdate:timeIndex":n[10]||(n[10]=f=>A(_)?_.value=f:null)},null,8,["repositories","type","grouping","kind","timeIndex"])])])])}}});export{Xe as default};
