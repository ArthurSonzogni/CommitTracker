import{_ as se}from"./S-oeU3K-.js";import{_ as de}from"./D3ms4flo.js";import{C as me,f as fe,g as pe,q as ve,s as P,h as A,D as be,B as ce,i as _e,r as S,o as R,c as Y,b as l,a as T,w as a,j as r,v as b,d as g,p as Z,l as z,t as G,F as ge,k as Ve}from"./CIIwfncC.js";import{f as ee}from"./D2nGpDRe.js";import{p as te}from"./BySFM-T0.js";import{a as we,i as oe,b as ye}from"./Dp_3OYB3.js";import{i as ke}from"./BnJ91Bvx.js";import{_ as xe}from"./DlAUqK2U.js";import"./BeACrgm2.js";function De(){var V=0,f=1,M,_,p,k,d=oe,m=!1,i;function y(s){return s==null||isNaN(s=+s)?i:d(p===0?.5:(s=(k(s)-M)*p,m?Math.max(0,Math.min(1,s)):s))}y.domain=function(s){return arguments.length?([V,f]=s,M=k(V=+V),_=k(f=+f),p=M===_?0:1/(_-M),y):[V,f]},y.clamp=function(s){return arguments.length?(m=!!s,y):m},y.interpolator=function(s){return arguments.length?(d=s,y):d};function q(s){return function(B){var N,j;return arguments.length?([N,j]=B,d=s(N,j),y):[d(0),d(1)]}}return y.range=q(ke),y.rangeRound=q(ye),y.unknown=function(s){return arguments.length?(i=s,y):i},function(s){return k=s,M=s(V),_=s(f),p=M===_?0:1/(_-M),y}}function Ue(V,f){return f.domain(V.domain()).interpolator(V.interpolator()).clamp(V.clamp()).unknown(V.unknown())}function ne(){var V=we(De()(oe));return V.copy=function(){return Ue(V,ne())},me.apply(V,arguments)}const qe={class:"section"},Me={class:"mycolumns"},Ce={id:"widget-colum"},$e=["href"],Se=["href"],Ae={class:"timeline"},Ne={class:"container"},he=fe({__name:"pivot-table",setup(V){const f=pe(),M=ve();P([]);const _=A([new Date("2015-01-01"),new Date]);f.query.start&&(_.value[0]=new Date(f.query.start)),f.query.end&&(_.value[1]=new Date(f.query.end));const p=A("components");f.query.l&&(p.value=f.query.l);const k=A(3);f.query.cd&&(k.value=parseInt(f.query.cd));const d=A("year");f.query.td&&(d.value=f.query.td);const m=A(["N/A","Low","Medium","High","Critical"]);f.query.s&&(m.value=f.query.s.split(","));const i=A("vrp_reward");f.query.v&&(i.value=f.query.v);const y=()=>{M.push({query:{start:_.value[0].toISOString().split("T")[0],end:_.value[1].toISOString().split("T")[0],cd:k.value,td:d.value,v:i.value,s:m.value.join(","),l:p.value}})},q=A(!0);let s={},B=P([]),N=P([]);const j=ee("$,.0f"),le=ee("$,.2f");let U=v=>v,h=v=>v,J=te().exponent(.2).domain([0,7e3]).range([0,1]),ae=ne(be);const re=(v,t)=>({style:{backgroundColor:ae(J(U(v[t.field])))}});ce(async()=>{s=(await(await fetch("/cve/data.json")).json()).map(t=>(["Low","Medium","High","Critical"].indexOf(t.severity)==-1&&(t.severity="N/A"),t)),W()});const ue=function*(v){if(yield"All",k.value==0)return;let t=[];for(const C of v.split(">"))if(t.push(C),yield t.join(">"),t.length==k.value)break},E=function*(v){if(!v)return"All";const t=new Set;for(const C of v)for(const c of ue(C))t.has(c)||(t.add(c),yield c)},K=v=>{switch(d.value){case"all":return"All";case"year":return`${v.getFullYear()}`;case"quarter":return`${v.getFullYear()}Q${Math.floor(v.getMonth()/3)+1}`;case"month":const t=(v.getMonth()+1).toString().padStart(2,"0");return`${v.getFullYear()}M${t}`}},W=()=>{var I,O;const v=new Set,t=new Set,C=Object.values(s).map(o=>{if(!m.value.includes(o.severity))return 0;const e=new Date(o.bug_date),n=new Date(o.version_dates.stable),u=new Date(o.published)||n||e;if(u<_.value[0]||u>_.value[1])return 0;const w=(n-e)/(1e3*60*60*24),ie=K(u);switch(v.add(ie),p.value){case"components":for(const L of E(o.components))t.add(L);break;case"repositories":const Q=new Set;for(const L in o.commits){const X=o.commits[L];X.repo&&Q.add(X.repo)}if(Q.length==0)return 0;for(const L of Q)t.add(L);break}return{date:u,cve:o,value:w}}).filter(o=>o!=0).sort((o,e)=>o.date-e.date),c=Array.from(v).sort(),x=Array.from(t).sort();N.value=[{field:"line",label:p.value=="components"?"Component":"Repository"}],N.value=c.map(o=>({field:o,label:o}));const H=new Set;switch(p.value){case"components":for(const o of C)for(const e of E(o.cve.components))H.add(e);break;case"repositories":for(const o of C){const e=new Array;for(const n in o.cve.commits){const u=o.cve.commits[n];u.repo&&e.push(u.repo)}for(const n of e)H.add(n)}break}const $=new Map;for(let o=0;o<x.length;++o)$.set(x[o],o);let D=x.map(o=>({line:o}));for(const o of C){const e=K(o.date);switch(p.value){case"components":for(const u of E(o.cve.components)){const w=$.get(u);w!==void 0&&((I=D[w])[e]||(I[e]=[]),D[w][e].push(o.cve))}break;case"repositories":const n=new Set;for(const u in o.cve.commits){const w=o.cve.commits[u];w.repo&&n.add(w.repo)}for(const u of n){const w=$.get(u);w!==void 0&&((O=D[w])[e]||(O[e]=[]),D[w][e].push(o.cve))}break}}switch(i.value){case"vrp_reward":U=o=>{if(!o)return 0;let e=0;for(const n of o)e+=parseInt(n.vrp_reward)||0;return e};break;case"cve_count":U=o=>o?o.length:0,h=U;break;case"time_to_fix_10p":U=o=>{if(!o||o.length==0)return 0;const e=o.map(n=>{const u=new Date(n.bug_date);return(new Date(n.version_dates.stable)-u)/(1e3*60*60*24)}).filter(n=>n).sort((n,u)=>n-u);return q.value&&e.length<12?0:e[Math.floor(e.length*.1)]};break;case"time_to_fix_median":U=o=>{if(!o||o.length==0)return 0;const e=o.map(n=>{const u=new Date(n.bug_date);return(new Date(n.version_dates.stable)-u)/(1e3*60*60*24)}).filter(n=>n).sort((n,u)=>n-u);return q.value&&e.length<6?0:e[Math.floor(e.length/2)]};break;case"time_to_fix_90p":U=o=>{if(!o||o.length==0)return 0;const e=o.map(n=>{const u=new Date(n.bug_date);return(new Date(n.version_dates.stable)-u)/(1e3*60*60*24)}).filter(n=>n).sort((n,u)=>n-u);return q.value&&e.length<12?0:e[Math.floor(e.length*.9)]};break}switch(i.value){case"vrp_reward":h=o=>{const e=U(o);return e==0?"":e>=1e6?le(e/1e6)+"M":e>=1e3?j(e/1e3)+"k":j(e)};break;case"cve_count":h=o=>{const e=U(o);return e==0?"":e};break;case"time_to_fix_10p":case"time_to_fix_median":case"time_to_fix_90p":h=o=>{const e=U(o);return e?`${Math.floor(e)}d`:""};break}let F=0;for(const o of D)for(const e of c){if(e=="line")continue;if(o[e]===void 0){o[e]=0;continue}const n=U(o[e]);n>F&&(F=n)}J=te().exponent(.3).domain([0,F]).range([0,.5]),B.value=D};return _e([i,p,k,_,q,m,d],()=>{y(),W()}),(v,t)=>{const C=se,c=S("b-radio-button"),x=S("b-field"),H=S("b-numberinput"),$=S("b-checkbox-button"),D=S("b-tooltip"),F=S("b-switch"),I=S("b-table-column"),O=S("b-table"),o=de;return R(),Y("div",null,[l(C),T("section",qe,[T("div",Me,[T("div",Ce,[l(x,{label:"Time division"},{default:a(()=>[l(c,{modelValue:r(d),"onUpdate:modelValue":t[0]||(t[0]=e=>b(d)?d.value=e:null),"native-value":"all"},{default:a(()=>t[19]||(t[19]=[g("All")])),_:1},8,["modelValue"]),l(c,{modelValue:r(d),"onUpdate:modelValue":t[1]||(t[1]=e=>b(d)?d.value=e:null),"native-value":"year"},{default:a(()=>t[20]||(t[20]=[g("Year")])),_:1},8,["modelValue"]),l(c,{modelValue:r(d),"onUpdate:modelValue":t[2]||(t[2]=e=>b(d)?d.value=e:null),"native-value":"quarter"},{default:a(()=>t[21]||(t[21]=[g("Quarter")])),_:1},8,["modelValue"]),l(c,{modelValue:r(d),"onUpdate:modelValue":t[3]||(t[3]=e=>b(d)?d.value=e:null),"native-value":"month"},{default:a(()=>t[22]||(t[22]=[g("Month")])),_:1},8,["modelValue"])]),_:1}),l(x,{label:"Lines"},{default:a(()=>[l(c,{modelValue:r(p),"onUpdate:modelValue":t[4]||(t[4]=e=>b(p)?p.value=e:null),"native-value":"components"},{default:a(()=>t[23]||(t[23]=[g("components")])),_:1},8,["modelValue"]),l(c,{modelValue:r(p),"onUpdate:modelValue":t[5]||(t[5]=e=>b(p)?p.value=e:null),"native-value":"repositories"},{default:a(()=>t[24]||(t[24]=[g("repositories")])),_:1},8,["modelValue"])]),_:1}),r(p)=="components"?(R(),Z(x,{key:0,label:"Components depths"},{default:a(()=>[l(H,{modelValue:r(k),"onUpdate:modelValue":t[6]||(t[6]=e=>b(k)?k.value=e:null),min:"0",max:"4",step:"1"},null,8,["modelValue"])]),_:1})):z("",!0),l(x,{label:"Severity"},{default:a(()=>[l($,{modelValue:r(m),"onUpdate:modelValue":t[7]||(t[7]=e=>b(m)?m.value=e:null),"native-value":"N/A"},{default:a(()=>t[25]||(t[25]=[g("N/A")])),_:1},8,["modelValue"]),l($,{modelValue:r(m),"onUpdate:modelValue":t[8]||(t[8]=e=>b(m)?m.value=e:null),"native-value":"Low"},{default:a(()=>t[26]||(t[26]=[g("Low")])),_:1},8,["modelValue"]),l($,{modelValue:r(m),"onUpdate:modelValue":t[9]||(t[9]=e=>b(m)?m.value=e:null),"native-value":"Medium"},{default:a(()=>t[27]||(t[27]=[g("Medium")])),_:1},8,["modelValue"]),l($,{modelValue:r(m),"onUpdate:modelValue":t[10]||(t[10]=e=>b(m)?m.value=e:null),"native-value":"High"},{default:a(()=>t[28]||(t[28]=[g("High")])),_:1},8,["modelValue"]),l($,{modelValue:r(m),"onUpdate:modelValue":t[11]||(t[11]=e=>b(m)?m.value=e:null),"native-value":"Critical"},{default:a(()=>t[29]||(t[29]=[g("Critical")])),_:1},8,["modelValue"])]),_:1}),l(x,{grouped:""},{default:a(()=>[l(x,{label:"Reward"},{default:a(()=>[l(c,{modelValue:r(i),"onUpdate:modelValue":t[12]||(t[12]=e=>b(i)?i.value=e:null),"native-value":"vrp_reward"},{default:a(()=>[l(D,{label:"VRP reward",position:"is-top"},{default:a(()=>t[30]||(t[30]=[g(" $$$ ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(x,{label:"CVE"},{default:a(()=>[l(c,{modelValue:r(i),"onUpdate:modelValue":t[13]||(t[13]=e=>b(i)?i.value=e:null),"native-value":"cve_count"},{default:a(()=>[l(D,{label:"Number of CVE",position:"is-top"},{default:a(()=>t[31]||(t[31]=[g(" Count ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(x,{label:"Velocity","label-position":"on"},{default:a(()=>[l(c,{modelValue:r(i),"onUpdate:modelValue":t[14]||(t[14]=e=>b(i)?i.value=e:null),"native-value":"time_to_fix_10p"},{default:a(()=>[l(D,{label:"Delay from bug reported to fix released to stable",position:"is-top"},{default:a(()=>t[32]||(t[32]=[g(" 10p ")])),_:1})]),_:1},8,["modelValue"]),l(c,{modelValue:r(i),"onUpdate:modelValue":t[15]||(t[15]=e=>b(i)?i.value=e:null),"native-value":"time_to_fix_median"},{default:a(()=>[l(D,{label:"Delay from bug reported to fix released to stable",position:"is-top"},{default:a(()=>t[33]||(t[33]=[g(" 50p ")])),_:1})]),_:1},8,["modelValue"]),l(c,{modelValue:r(i),"onUpdate:modelValue":t[16]||(t[16]=e=>b(i)?i.value=e:null),"native-value":"time_to_fix_90p"},{default:a(()=>[l(D,{label:"Delay from bug reported to fix released to stable",position:"is-top"},{default:a(()=>t[34]||(t[34]=[g(" 90p ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{label:"Hide non representative data"},{default:a(()=>[l(F,{modelValue:r(q),"onUpdate:modelValue":t[17]||(t[17]=e=>b(q)?q.value=e:null),type:"is-info"},null,8,["modelValue"])]),_:1})]),l(O,{id:"table-column",data:r(B),striped:"",bordered:"",scrollable:"","sticky-header":"",height:"85vh"},{default:a(()=>[l(I,{field:"component",label:"Component",sortable:"",sticky:""},{default:a(e=>[g(G(e.row.line),1)]),_:1}),(R(!0),Y(ge,null,Ve(r(N).sort((e,n)=>e.label.localeCompare(n.label)),e=>(R(),Z(I,{"draggable-column":"",field:e.field,label:e.label,"td-attrs":re,sortable:""},{default:a(n=>[r(p)=="components"?(R(),Y("a",{key:0,href:`/cve/list?group_by=component&component=${n.row.line}&date=${e.label}`,class:"table_link"},G(r(h)(n.row[e.field])),9,$e)):z("",!0),r(p)=="repositories"?(R(),Y("a",{key:1,href:`/cve/list?group_by=component&repo=${n.row.line}&date=${e.label}`,class:"table_link"},G(r(h)(n.row[e.field])),9,Se)):z("",!0)]),_:2},1032,["field","label"]))),256))]),_:1},8,["data"])])]),T("section",Ae,[T("div",Ne,[l(o,{modelValue:r(_),"onUpdate:modelValue":t[18]||(t[18]=e=>b(_)?_.value=e:null),minDate:new Date("2010-01-01")},null,8,["modelValue","minDate"])])])])}}}),Ye=xe(he,[["__scopeId","data-v-787d4b0c"]]);export{Ye as default};
