import{s as C}from"./DkrfxnvH.js";import{a4 as be,f as fe,S as me,h as j,A as J,i as V,D as ge,o as I,c as K,j as Q,a as G,p as ye,l as xe,F as $e}from"./BJdbIX9c.js";import{m as de,_ as De}from"./DkkWKaWJ.js";import{c as Te,n as Be,a as Se,l as ke}from"./E4HCz5LM.js";import{w as Pe,c as W}from"./BJcRDRUM.js";import{i as L}from"./C5X8qJ2i.js";import{_ as je}from"./DlAUqK2U.js";import{_ as ze}from"./DISM4ima.js";import{d as Ee}from"./rlX7cRMw.js";function Ae(r){return Math.sign(r)*r*r}function Ne(r){return Math.sign(r)*Math.sqrt(Math.abs(r))}function Re(){var r=Te(),m=[0,1],b=!1,$;function v(g){var y=Ne(r(g));return isNaN(y)?$:b?Math.round(y):y}return v.invert=function(g){return r.invert(Ae(g))},v.domain=function(g){return arguments.length?(r.domain(g),v):r.domain()},v.range=function(g){return arguments.length?(r.range((m=Array.from(g,Be)).map(Ae)),v):m.slice()},v.rangeRound=function(g){return v.range(g).round(!0)},v.round=function(g){return arguments.length?(b=!!g,v):b},v.clamp=function(g){return arguments.length?(r.clamp(g),v):r.clamp()},v.unknown=function(g){return arguments.length?($=g,v):$},v.copy=function(){return Re(r.domain(),m).round(b).clamp(r.clamp()).unknown($)},be.apply(v,arguments),Se(v)}var Ce=0;function Me(){return new pe}function pe(){this._="@"+(++Ce).toString(36)}pe.prototype=Me.prototype={constructor:pe,get:function(r){for(var m=this._;!(m in r);)if(!(r=r.parentNode))return;return r[m]},set:function(r,m){return r[this._]=m},remove:function(r){return this._ in r&&delete r[this._]},toString:function(){return this._}};const _e=Math.abs,S=Math.atan2,q=Math.cos,We=Math.max,ce=Math.min,z=Math.sin,H=Math.sqrt,P=1e-12,U=Math.PI,re=U/2,qe=2*U;function Ie(r){return r>1?0:r<-1?U:Math.acos(r)}function we(r){return r>=1?re:r<=-1?-re:Math.asin(r)}function Oe(r){return r.innerRadius}function Fe(r){return r.outerRadius}function Le(r){return r.startAngle}function He(r){return r.endAngle}function Je(r){return r&&r.padAngle}function Ve(r,m,b,$,v,g,y,s){var M=b-r,c=$-m,o=y-v,x=s-g,i=x*M-o*c;if(!(i*i<P))return i=(o*(m-g)-x*(r-v))/i,[r+i*M,m+i*c]}function ne(r,m,b,$,v,g,y){var s=r-b,M=m-$,c=(y?g:-g)/H(s*s+M*M),o=c*M,x=-c*s,i=r+o,h=m+x,p=b+o,D=$+x,_=(i+p)/2,l=(h+D)/2,R=p-i,n=D-h,a=R*R+n*n,A=v-g,w=i*D-p*h,f=(n<0?-1:1)*H(We(0,A*A*a-w*w)),B=(w*n-R*f)/a,k=(-w*R-n*f)/a,T=(w*n+R*f)/a,e=(-w*R+n*f)/a,d=B-_,t=k-l,u=T-_,E=e-l;return d*d+t*t>u*u+E*E&&(B=T,k=e),{cx:B,cy:k,x01:-o,y01:-x,x11:B*(v/A-1),y11:k*(v/A-1)}}function Ge(){var r=Oe,m=Fe,b=W(0),$=null,v=Le,g=He,y=Je,s=null,M=Pe(c);function c(){var o,x,i=+r.apply(this,arguments),h=+m.apply(this,arguments),p=v.apply(this,arguments)-re,D=g.apply(this,arguments)-re,_=_e(D-p),l=D>p;if(s||(s=o=M()),h<i&&(x=h,h=i,i=x),!(h>P))s.moveTo(0,0);else if(_>qe-P)s.moveTo(h*q(p),h*z(p)),s.arc(0,0,h,p,D,!l),i>P&&(s.moveTo(i*q(D),i*z(D)),s.arc(0,0,i,D,p,l));else{var R=p,n=D,a=p,A=D,w=_,f=_,B=y.apply(this,arguments)/2,k=B>P&&($?+$.apply(this,arguments):H(i*i+h*h)),T=ce(_e(h-i)/2,+b.apply(this,arguments)),e=T,d=T,t,u;if(k>P){var E=we(k/i*z(B)),X=we(k/h*z(B));(w-=E*2)>P?(E*=l?1:-1,a+=E,A-=E):(w=0,a=A=(p+D)/2),(f-=X*2)>P?(X*=l?1:-1,R+=X,n-=X):(f=0,R=n=(p+D)/2)}var O=h*q(R),F=h*z(R),Y=i*q(A),Z=i*z(A);if(T>P){var ee=h*q(n),te=h*z(n),ae=i*q(a),oe=i*z(a),N;if(_<U)if(N=Ve(O,F,ae,oe,ee,te,Y,Z)){var se=O-N[0],ie=F-N[1],le=ee-N[0],ue=te-N[1],he=1/z(Ie((se*le+ie*ue)/(H(se*se+ie*ie)*H(le*le+ue*ue)))/2),ve=H(N[0]*N[0]+N[1]*N[1]);e=ce(T,(i-ve)/(he-1)),d=ce(T,(h-ve)/(he+1))}else e=d=0}f>P?d>P?(t=ne(ae,oe,O,F,h,d,l),u=ne(ee,te,Y,Z,h,d,l),s.moveTo(t.cx+t.x01,t.cy+t.y01),d<T?s.arc(t.cx,t.cy,d,S(t.y01,t.x01),S(u.y01,u.x01),!l):(s.arc(t.cx,t.cy,d,S(t.y01,t.x01),S(t.y11,t.x11),!l),s.arc(0,0,h,S(t.cy+t.y11,t.cx+t.x11),S(u.cy+u.y11,u.cx+u.x11),!l),s.arc(u.cx,u.cy,d,S(u.y11,u.x11),S(u.y01,u.x01),!l))):(s.moveTo(O,F),s.arc(0,0,h,R,n,!l)):s.moveTo(O,F),!(i>P)||!(w>P)?s.lineTo(Y,Z):e>P?(t=ne(Y,Z,ee,te,i,-e,l),u=ne(O,F,ae,oe,i,-e,l),s.lineTo(t.cx+t.x01,t.cy+t.y01),e<T?s.arc(t.cx,t.cy,e,S(t.y01,t.x01),S(u.y01,u.x01),!l):(s.arc(t.cx,t.cy,e,S(t.y01,t.x01),S(t.y11,t.x11),!l),s.arc(0,0,i,S(t.cy+t.y11,t.cx+t.x11),S(u.cy+u.y11,u.cx+u.x11),l),s.arc(u.cx,u.cy,e,S(u.y11,u.x11),S(u.y01,u.x01),!l))):s.arc(0,0,i,A,a,l)}if(s.closePath(),o)return s=null,o+""||null}return c.centroid=function(){var o=(+r.apply(this,arguments)+ +m.apply(this,arguments))/2,x=(+v.apply(this,arguments)+ +g.apply(this,arguments))/2-U/2;return[q(x)*o,z(x)*o]},c.innerRadius=function(o){return arguments.length?(r=typeof o=="function"?o:W(+o),c):r},c.outerRadius=function(o){return arguments.length?(m=typeof o=="function"?o:W(+o),c):m},c.cornerRadius=function(o){return arguments.length?(b=typeof o=="function"?o:W(+o),c):b},c.padRadius=function(o){return arguments.length?($=o==null?null:typeof o=="function"?o:W(+o),c):$},c.startAngle=function(o){return arguments.length?(v=typeof o=="function"?o:W(+o),c):v},c.endAngle=function(o){return arguments.length?(g=typeof o=="function"?o:W(+o),c):g},c.padAngle=function(o){return arguments.length?(y=typeof o=="function"?o:W(+o),c):y},c.context=function(o){return arguments.length?(s=o??null,c):s},c}const Ke=["width","height"],Qe=fe({__name:"TimelineWrappedChart",props:{repositories:{type:Array[String],default:()=>["chromium"]},developers:{type:Array},dates:{type:Array[Date]},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean},hourlyParam:{type:Number},buckets:{type:Number,default:24}},setup(r){const m=[["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]],b=Me(),$=new Date,{$chromiumDataAll:v,$color:g}=me(),y=r,s=j(null),M=j(null),c=j(null),o=j(null),x=j([]),i=j(300),h=J(()=>{switch(y.hourlyParam){case 0:return 24*60*60*1e3;case 1:return 7*24*60*60*1e3;case 2:return 365*24*60*60*1e3}return 0}),p=J(()=>{const n=x.value.map(w=>w.developer);let a=x.value;a=a.map(w=>{let f=w.data;y.author||(f=f.filter(k=>k.kind!="author")),y.review||(f=f.filter(k=>k.kind!="review"));const B=f.map(k=>new Date(k.date)).sort((k,T)=>k-T).filter(k=>k>=y.dates[0]&&k<=y.dates[1]);return{developer:w.developer,values:B.map(k=>($-k)%h.value/h.value)}});let A=new Array(y.buckets).fill(0);return a=a.map(w=>{const f=[...A];w.values.forEach(k=>{f[Math.floor(k*y.buckets)]++});const B={developer:w.developer,values:f.map((k,T)=>({angle:T,buckets:y.buckets,inner:A[T],outer:f[T],developer:w.developer}))};return A=y.stacked?f:new Array(y.buckets).fill(0),B}),a=a.map(w=>w.values).flat(),{developers:n,arcs:a}}),D=J(()=>de(p.value.arcs.map(n=>n.outer))),_=async()=>{x.value=await v(y.repositories,y.developers)},l=()=>{var n;try{i.value=((n=s.value)==null?void 0:n.clientWidth)||300,i.value=Math.min(i.value,800),i.value=Math.min(i.value,window.innerWidth*.8),i.value=Math.min(i.value,Math.max(0,(window.innerHeight-300)*.9))}catch(a){console.log(a)}_(),R(),window.addEventListener("resize",l)},R=()=>{C(M.value).attr("transform",`translate(${i.value/2}, ${i.value/2})`),C(c.value).attr("transform",`translate(${i.value/2}, ${i.value/2})`);const n=i.value*.2,a=i.value*.5,A=ke().domain([0,y.buckets]).range([0,2*Math.PI]),w=Re().domain([0,D.value]).range([n,a]),f=e=>({startAngle:A(e.angle),endAngle:A(e.angle+1),padAngle:A(.05),innerRadius:w(e.inner),outerRadius:w(e.outer)}),B=function(e,d){return function(t){const u={startAngle:L(e.startAngle,d.startAngle)(t),endAngle:L(e.endAngle,d.endAngle)(t),innerRadius:L(e.innerRadius,d.innerRadius)(t),outerRadius:L(e.outerRadius,d.outerRadius)(t),padAngle:L(e.padAngle,d.padAngle)(t)};return b.set(this,u),k(u)}},k=Ge().innerRadius(e=>e.innerRadius).outerRadius(e=>e.outerRadius).startAngle(e=>-e.endAngle).endAngle(e=>-e.startAngle).padAngle(e=>e.padAngle).cornerRadius(e=>e.padAngle*1e3);C(M.value).selectAll("path").data(p.value.arcs,e=>`${e.developer}-${e.angle}-${e.buckets}`).join(e=>e.append("path").attr("fill",d=>g(d.developer)).attr("d",d=>k(f(d))).attr("opacity",0).transition().duration(1e3).attr("opacity",.5).attrTween("d",function(d){const t=f({angle:d.angle,inner:0,outer:0}),u=f(d);return B(t,u)}),e=>e.transition().duration(1e3).attr("opacity",.5).attrTween("d",function(d){const t=b.get(this),u=f(d);return B(t,u)}),e=>e.transition().duration(1e3).attr("opacity",0).attrTween("d",function(d){const t=b.get(this),u=f({angle:0,padAngle:0,inner:0,outer:0});return u.startAngle=t.startAngle,u.endAngle=t.endAngle,u.padAngle=t.padAngle,B(t,u)}).remove());const T=m[y.hourlyParam].map((e,d)=>{const u=($-new Date("2000-01-03T00:00:00.000"))%h.value/h.value,E=d/m[y.hourlyParam].length;return{text:e,angle:(E-u-.25)*360}});C(c.value).selectAll("text").data(T,e=>`${e.text}-${e.angle}`).join(e=>e.append("text").attr("x",n*.5).attr("y",0).attr("text-anchor","end").attr("alignment-baseline","middle").attr("opacity",1).text(d=>d.text).attr("transform",d=>`rotate(${d.angle})`).transition().duration(1e3).attr("font-size",n*.1).attr("x",n*.9).attr("opacity",.5),e=>e.transition().duration(1e3).attr("font-size",n*.1).attr("x",n*.9).attr("opacity",.5),e=>e.transition().duration(1e3).attr("x",n*1).attr("opacity",0).remove()),C(o.value).selectAll(".legend").data(p.value.developers,e=>e).join(e=>{const d=e.append("g").attr("class","legend");return d.attr("opacity",0).attr("transform",(t,u)=>`translate(100, ${u*20+20})`).transition().duration(500).attr("transform",(t,u)=>`translate(10, ${u*20+20})`).attr("opacity",1),d.append("text").attr("font-size","12px").attr("font-weight","bold").attr("fill",t=>g(t)).text(t=>t),d},e=>(e.transition().duration(1e3).attr("transform",(d,t)=>`translate(10, ${t*20+20})`).attr("opacity",1),e),e=>{e.transition().duration(500).attr("transform",(d,t)=>`translate(100, ${t*20+20})`).attr("opacity",0).remove()})};return V(()=>y.developers,_),V(()=>y.repositories,_),V(p,R),ge(l),(n,a)=>(I(),K("div",{ref_key:"container",ref:s,align:"center"},[(I(),K("svg",{ref:"svg",width:Q(i),height:Q(i)},[G("g",{ref_key:"arcs",ref:M},null,512),G("g",{ref_key:"indicators",ref:c},null,512),G("g",{ref_key:"legend",ref:o},null,512)],8,Ke))],512))}}),st=je(Qe,[["__scopeId","data-v-67abbf34"]]),it=fe({__name:"TimelineChart",props:{repositories:{type:Array,default:()=>["chromium"]},chart:{type:String,default:"line"},developers:{type:Array},dates:{type:Array},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean}},setup(r){const m=r,b=j([]),{$chromiumDataAll:$}=me(),v=J(()=>{let s=b.value.map(M=>{let c=M.data;m.author||(c=c.filter(x=>x.kind!="author")),m.review||(c=c.filter(x=>x.kind!="review"));const o=c.map(x=>new Date(x.date)).sort((x,i)=>x-i).filter(x=>x>=m.dates[0]&&x<=m.dates[1]);return{label:M.developer,values:o}});if(m.stacked){let M=[];s=s.map((c,o)=>{let x=c.label;return o!=0&&(x+=" (+"+o+")"),M=M.concat(c.values).sort((i,h)=>i-h),{label:x,values:M}})}return s=s.map(M=>{let c=0;return{label:M.label,values:M.values.map(o=>(c++,{x:o,y:m.chart=="line"?c:1}))}}),s}),g=async()=>{const s=await $(m.repositories[0],m.developers);b.value=s};V(()=>[m.developers,m.repositories],g);const y=()=>{g()};return ge(()=>{y()}),(s,M)=>{const c=De,o=ze;return I(),K($e,null,[r.chart=="line"?(I(),ye(c,{key:0,data:Q(v)},null,8,["data"])):xe("",!0),r.chart=="heatmap"?(I(),ye(o,{key:1,data:Q(v)},null,8,["data"])):xe("",!0)],64)}}}),Ue=["height"],lt=fe({__name:"PeersChart",props:{repositories:{type:Array[String],default:()=>["chromium"]},developers:{type:Array},dates:{type:Array[Date]},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean},take_n:{type:Number,default:60}},setup(r){const{$chromiumDataAll:m,$color:b}=me(),$=j(null),v=j(null),g=j(null),y=j(null),s=r,M=j([]),c=J(()=>s.take_n*20+50),o=async()=>{M.value=await m(s.repositories[0],s.developers)},x=J(()=>{const h=M.value.map(_=>{let l=_.data.filter(a=>{const A=new Date(a.date);return A>=s.dates[0]&&A<=s.dates[1]});s.author||(l=l.filter(a=>a.kind!="author")),s.review||(l=l.filter(a=>a.kind!="review"));const R=l.map(a=>a.peers).flat(),n={};return R.forEach(a=>{n[a]||(n[a]=0),n[a]++}),{developer:_.developer,peers:n}}),p={};h.forEach(_=>{Object.entries(_.peers).forEach(([l,R])=>{p[l]||(p[l]={}),p[l][_.developer]=R})});for(const _ in p){let l=0;Object.entries(p[_]).forEach(([R,n])=>{p[_][R]={left:l,right:l+n},s.stacked&&(l+=n)})}const D=[];for(const _ in p){let l=0;Object.entries(p[_]).forEach(([,R])=>{l=Math.max(l,R.right)}),D.push({peer:_,developers:Object.entries(p[_]).map(([R,n])=>({developer:R,left:n.left,right:n.right})),max:l})}return D.sort((_,l)=>l.max-_.max),D.splice(0,s.take_n)}),i=()=>{var R;const h=((R=$.value)==null?void 0:R.clientWidth)||800,p=ke().domain([0,de(x.value,n=>de(n.developers,a=>a.right))]).range([0,h-200]),D=Ee(p);C(g.value).attr("transform","translate(130, 25)").transition().duration(500).call(D),C(y.value).attr("transform","translate(130, 50)");const _=n=>{n.transition().duration(500).attr("opacity",1).attr("transform",(a,A)=>`translate(0, ${A*20})`)},l=n=>{n.transition().duration(500).attr("opacity",.5).attr("x",a=>p(a.left)).attr("width",a=>p(a.right-a.left))};C(y.value).selectAll("g").data(x.value,n=>n.peer).join(n=>{const a=n.append("g");return a.attr("opacity",0).attr("transform",(f,B)=>`translate(-100, ${B*20})`),_(a),a.append("text").attr("class","peer").text(f=>f.peer).attr("font-size",f=>Math.min(230/(1+f.peer.length),16)+"px").attr("text-anchor","end").attr("text-baseline","middle").attr("x",-5).attr("color",f=>b(f.peer)),a.append("text").attr("class","value").text(f=>f.max).attr("text-anchor","start").attr("text-baseline","bottom").attr("x",f=>p(f.max)+5),a},n=>{const a=n;return _(a),a.select(".value").transition().duration(500).attr("x",w=>p(w.max)).textTween((w,f,B)=>{const k=C(B[f]).text(),T=L(k,w.max);return e=>Math.round(T(e))}),a},n=>(n.transition().duration(500).attr("opacity",0).attr("transform",(a,A)=>`translate(100, ${A*20})`).remove(),n)).selectAll("rect").data(n=>n.developers,n=>n.developer).join(n=>{const a=n.append("rect").attr("opacity",0).attr("rx",5).attr("ry",5).attr("x",A=>p(A.left)).attr("y",-15).attr("width",A=>p(A.right-A.left)).attr("height",19).attr("fill",A=>b(A.developer));return l(a),a},n=>{const a=n;return l(a),a},n=>(n.transition().duration(500).attr("opacity",0).remove(),n))};return V(()=>[s.developers,s.repositories],o),window.addEventListener("resize",i),ge(i),V(x,i),o(),(h,p)=>(I(),K("div",{ref_key:"container",ref:$,align:"center"},[(I(),K("svg",{ref_key:"svg",ref:v,width:"100%",height:Q(c)},[G("g",{ref_key:"axis",ref:g},null,512),G("g",{ref_key:"authors",ref:y},null,512)],8,Ue))],512))}});export{st as _,it as a,lt as b};
