import{_ as ft}from"./S-oeU3K-.js";import{_ as dt}from"./D3ms4flo.js";import{t as X,s as b}from"./CNzZi2nf.js";import{f as pt,g as gt,q as ht,h as T,E as mt,G as yt,B as kt,i as wt,o as et,c as ot,b as rt,a as y,t as G,j as B,v as vt}from"./CIIwfncC.js";import{f as st}from"./D2nGpDRe.js";import{p as Y}from"./Drloq0xg.js";import{p as xt}from"./DKbKBQE1.js";import{_ as _t}from"./DlAUqK2U.js";import"./BeACrgm2.js";function Z(i){return((i*=2)<=1?i*i:--i*(2-i)+1)/2}function at(i,l){let u;if(l===void 0)for(const c of i)c!=null&&(u<c||u===void 0&&c>=c)&&(u=c);else{let c=-1;for(let f of i)(f=l(f,++c,i))!=null&&(u<f||u===void 0&&f>=f)&&(u=f)}return u}function Lt(i,l){let u;if(l===void 0)for(const c of i)c!=null&&(u>c||u===void 0&&c>=c)&&(u=c);else{let c=-1;for(let f of i)(f=l(f,++c,i))!=null&&(u>f||u===void 0&&f>=f)&&(u=f)}return u}function tt(i,l){let u=0;if(l===void 0)for(let c of i)(c=+c)&&(u+=c);else{let c=-1;for(let f of i)(f=+l(f,++c,i))&&(u+=f)}return u}function bt(i){return i.depth}function St(i,l){return i.sourceLinks.length?i.depth:l-1}function H(i){return function(){return i}}function it(i,l){return F(i.source,l.source)||i.index-l.index}function lt(i,l){return F(i.target,l.target)||i.index-l.index}function F(i,l){return i.y0-l.y0}function nt(i){return i.value}function Tt(i){return i.index}function Bt(i){return i.nodes}function It(i){return i.links}function ct(i,l){const u=i.get(l);if(!u)throw new Error("missing: "+l);return u}function ut({nodes:i}){for(const l of i){let u=l.y0,c=u;for(const f of l.sourceLinks)f.y0=u+f.width/2,u+=f.width;for(const f of l.targetLinks)f.y1=c+f.width/2,c+=f.width}}function Nt(){let i=0,l=0,u=1,c=1,f=24,D=8,h,z=Tt,C=St,S,L,I=Bt,N=It,m=6;function p(){const e={nodes:I.apply(null,arguments),links:N.apply(null,arguments)};return V(e),P(e),q(e),x(e),M(e),ut(e),e}p.update=function(e){return ut(e),e},p.nodeId=function(e){return arguments.length?(z=typeof e=="function"?e:H(e),p):z},p.nodeAlign=function(e){return arguments.length?(C=typeof e=="function"?e:H(e),p):C},p.nodeSort=function(e){return arguments.length?(S=e,p):S},p.nodeWidth=function(e){return arguments.length?(f=+e,p):f},p.nodePadding=function(e){return arguments.length?(D=h=+e,p):D},p.nodes=function(e){return arguments.length?(I=typeof e=="function"?e:H(e),p):I},p.links=function(e){return arguments.length?(N=typeof e=="function"?e:H(e),p):N},p.linkSort=function(e){return arguments.length?(L=e,p):L},p.size=function(e){return arguments.length?(i=l=0,u=+e[0],c=+e[1],p):[u-i,c-l]},p.extent=function(e){return arguments.length?(i=+e[0][0],u=+e[1][0],l=+e[0][1],c=+e[1][1],p):[[i,l],[u,c]]},p.iterations=function(e){return arguments.length?(m=+e,p):m};function V({nodes:e,links:a}){for(const[s,o]of e.entries())o.index=s,o.sourceLinks=[],o.targetLinks=[];const r=new Map(e.map((s,o)=>[z(s,o,e),s]));for(const[s,o]of a.entries()){o.index=s;let{source:t,target:n}=o;typeof t!="object"&&(t=o.source=ct(r,t)),typeof n!="object"&&(n=o.target=ct(r,n)),t.sourceLinks.push(o),n.targetLinks.push(o)}if(L!=null)for(const{sourceLinks:s,targetLinks:o}of e)s.sort(L),o.sort(L)}function P({nodes:e}){for(const a of e)a.value=a.fixedValue===void 0?Math.max(tt(a.sourceLinks,nt),tt(a.targetLinks,nt)):a.fixedValue}function q({nodes:e}){const a=e.length;let r=new Set(e),s=new Set,o=0;for(;r.size;){for(const t of r){t.depth=o;for(const{target:n}of t.sourceLinks)s.add(n)}if(++o>a)throw new Error("circular link");r=s,s=new Set}}function x({nodes:e}){const a=e.length;let r=new Set(e),s=new Set,o=0;for(;r.size;){for(const t of r){t.height=o;for(const{source:n}of t.targetLinks)s.add(n)}if(++o>a)throw new Error("circular link");r=s,s=new Set}}function w({nodes:e}){const a=at(e,o=>o.depth)+1,r=(u-i-f)/(a-1),s=new Array(a);for(const o of e){const t=Math.max(0,Math.min(a-1,Math.floor(C.call(null,o,a))));o.layer=t,o.x0=i+t*r,o.x1=o.x0+f,s[t]?s[t].push(o):s[t]=[o]}if(S)for(const o of s)o.sort(S);return s}function j(e){const a=Lt(e,r=>(c-l-(r.length-1)*h)/tt(r,nt));for(const r of e){let s=l;for(const o of r){o.y0=s,o.y1=s+o.value*a,s=o.y1+h;for(const t of o.sourceLinks)t.width=t.value*a}s=(c-s+h)/(r.length+1);for(let o=0;o<r.length;++o){const t=r[o];t.y0+=s*(o+1),t.y1+=s*(o+1)}$(r)}}function M(e){const a=w(e);h=Math.min(D,(c-l)/(at(a,r=>r.length)-1)),j(a);for(let r=0;r<m;++r){const s=Math.pow(.99,r),o=Math.max(1-s,(r+1)/m);U(a,s,o),O(a,s,o)}}function O(e,a,r){for(let s=1,o=e.length;s<o;++s){const t=e[s];for(const n of t){let d=0,g=0;for(const{source:_,value:Q}of n.targetLinks){let W=Q*(n.layer-_.layer);d+=A(_,n)*W,g+=W}if(!(g>0))continue;let v=(d/g-n.y0)*a;n.y0+=v,n.y1+=v,K(n)}S===void 0&&t.sort(F),R(t,r)}}function U(e,a,r){for(let s=e.length,o=s-2;o>=0;--o){const t=e[o];for(const n of t){let d=0,g=0;for(const{target:_,value:Q}of n.sourceLinks){let W=Q*(_.layer-n.layer);d+=E(n,_)*W,g+=W}if(!(g>0))continue;let v=(d/g-n.y0)*a;n.y0+=v,n.y1+=v,K(n)}S===void 0&&t.sort(F),R(t,r)}}function R(e,a){const r=e.length>>1,s=e[r];J(e,s.y0-h,r-1,a),k(e,s.y1+h,r+1,a),J(e,c,e.length-1,a),k(e,l,0,a)}function k(e,a,r,s){for(;r<e.length;++r){const o=e[r],t=(a-o.y0)*s;t>1e-6&&(o.y0+=t,o.y1+=t),a=o.y1+h}}function J(e,a,r,s){for(;r>=0;--r){const o=e[r],t=(o.y1-a)*s;t>1e-6&&(o.y0-=t,o.y1-=t),a=o.y0-h}}function K({sourceLinks:e,targetLinks:a}){if(L===void 0){for(const{source:{sourceLinks:r}}of a)r.sort(lt);for(const{target:{targetLinks:r}}of e)r.sort(it)}}function $(e){if(L===void 0)for(const{sourceLinks:a,targetLinks:r}of e)a.sort(lt),r.sort(it)}function A(e,a){let r=e.y0-(e.sourceLinks.length-1)*h/2;for(const{target:s,width:o}of e.sourceLinks){if(s===a)break;r+=o+h}for(const{source:s,width:o}of a.targetLinks){if(s===e)break;r-=o}return r}function E(e,a){let r=a.y0-(a.targetLinks.length-1)*h/2;for(const{source:s,width:o}of a.targetLinks){if(s===e)break;r+=o+h}for(const{target:s,width:o}of e.sourceLinks){if(s===a)break;r-=o}return r}return p}const jt={class:"section"},Mt={class:"container"},Dt=["width","height"],zt={class:"timeline"},Ct={class:"container"},Vt=pt({__name:"reward_per_components",setup(i){const l=st("$,.0f"),u=st(".2%"),c=gt(),f=ht(),D=T(0),h=T(0),z=T(null),C=T(null),S=T(null),L=T(null),I=T(2e3),N=T(2e3),m=T([new Date(new Date().setDate(new Date().getDate()-365)),new Date]);c.query.start&&(m.value[0]=new Date(c.query.start)),c.query.end&&(m.value[1]=new Date(c.query.end));const p=()=>{f.push({query:{start:m.value[0].toISOString().split("T")[0],end:m.value[1].toISOString().split("T")[0]}})},V=mt(yt);let P={};kt(async()=>{P=await(await fetch("/cve/data.json")).json(),q()});const q=()=>{const x={nodes:[],links:[]},w={},j={},M=t=>(w[t]===void 0&&(w[t]=x.nodes.length,x.nodes.push({node:w[t],name:t})),w[t]),O=(t,n,d)=>{const g=`${t}-${n}`;j[g]===void 0&&(j[g]=x.links.length,x.links.push({source:t,target:n,value:0})),x.links[j[g]].value+=d};let U=0,R=0;const k={};for(const t of P){const n=new Date(t.bug_date);if(!(n<m.value[0]||n>m.value[1])){R+=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward),U+=1;for(const d of t.components||[]){let g=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward);g/=t.components.length,k[d]||(k[d]=0),k[d]+=g}}}D.value=U,h.value=R;for(const t in k)k[t]==0&&delete k[t];N.value=Math.max(500,35*Math.pow(Object.keys(k).length,.8)),I.value=window.innerWidth,Object.entries(k).sort((t,n)=>t[0].localeCompare(n[0])).forEach(([t,n])=>{const d=t.split(">");let g=M("All");k.All||(k.All=0);for(let v=0;v<d.length;v++){const _=d.slice(0,v+1).join(">");O(g,M(_),n),g=M(_)}});for(const t of x.nodes){t.component=t.name;const n=t.name.split(">");t.name=n[n.length-1]}const $=Nt().nodeId(t=>t.node).nodeWidth(6).nodePadding(7).nodeAlign(bt).size([I.value-200,N.value-100]).nodeSort(null)(x),A=X().duration(500).delay(300).ease(Z),E=X().duration(200).ease(Z),e=X().duration(200).ease(Z),a=t=>{t.attr("x",n=>n.x0).attr("y",n=>n.y0).attr("height",n=>n.y1-n.y0).attr("width",n=>n.x1-n.x0)};b(z.value).attr("transform","translate(100,50)").selectAll("rect").data($.nodes,t=>t.component).join(t=>{const n=t.append("rect");return a(n),n.attr("fill",d=>V(d.component)).attr("opacity",0).attr("transform","translate(30,0)").transition(A).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(E),a(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()});const r=t=>{t.attr("d",n=>{const d=(n.target.x0-n.source.x1)*.3,g=xt();return g.moveTo(n.source.x1,n.y0-n.width/2),g.bezierCurveTo(n.source.x1+d,n.y0-n.width/2,n.target.x0-d,n.y1-n.width/2,n.target.x0,n.y1-n.width/2),g.lineTo(n.target.x0,n.y1+n.width/2),g.bezierCurveTo(n.target.x0-d,n.y1+n.width/2,n.source.x1+d,n.y0+n.width/2,n.source.x1,n.y0+n.width/2),g.closePath(),g.toString()})};b(C.value).attr("opacity",.2).attr("transform","translate(100,50)").selectAll("path").data($.links,t=>t.source.component+t.target.name).join(t=>{const n=t.append("path");return r(n),n.attr("fill",d=>V(d.source.component)).attr("opacity",0).attr("transform","translate(30,0)").transition(A).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(E),r(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()}).on("mouseover",function(t,n){const[d,g]=Y(t);Y(t),b(this).attr("opacity",.5);const v=b(".tooltip").style("display","block").style("position","absolute").attr("transform",`translate(${d},${g})`).attr("pointer-events","none"),_=v.select("text").attr("font-size",20).attr("fill","black").attr("pointer-events","none").text(n.target.name+": "+l(n.value)+`
          (${u(n.value/h.value)})`);v.select("rect").attr("x",-10).attr("y",-30).attr("width",_.node().getBBox().width+20).attr("height",_.node().getBBox().height+20).attr("fill",V(n.source.component)).attr("rx",5).attr("ry",5).attr("pointer-events","none").attr("stroke","black").attr("stroke-width",1)}).on("mousemove",function(t){const[n,d]=Y(t);b(".tooltip").attr("transform",`translate(${n},${d})`)}).on("mouseout",function(t,n){b(".tooltip").style("display","none"),b(this).attr("fill",V(n.source.component)),b(this).attr("opacity",1)});const s=t=>{t.attr("x",n=>n.x0+10).attr("y",n=>(n.y1+n.y0)/2).attr("text-anchor","start").attr("alignment-baseline","middle").text(n=>n.name).attr("font-size",n=>Math.max(Math.pow(n.y1-n.y0,.2)*5,10))};b(S.value).attr("transform","translate(100,50)").selectAll("text").data($.nodes,t=>t.component).join(t=>{const n=t.append("text");return s(n),n.attr("opacity",0).attr("transform","translate(30,0)").transition(A).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(E),s(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()});const o=t=>{t.attr("transform",n=>`translate(${n.target.x0-10}, ${(n.target.y1+n.target.y0)/2})`).attr("font-size",n=>Math.max(Math.pow(n.target.y1-n.target.y0,.2)*5,10)).text(n=>l(n.value))};b(L.value).attr("transform","translate(100,50)").selectAll("text").data($.links,t=>t.source.component+t.target.component).join(t=>{const n=t.append("text");return n.attr("text-anchor","end"),n.attr("alignment-baseline","middle"),o(n),n.attr("opacity",0).transition(A).attr("opacity",1),n},t=>(t=t.transition(E),o(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()})};return wt(m,()=>{p(),q()}),window.addEventListener("resize",()=>{q()}),(x,w)=>{const j=ft,M=dt;return et(),ot("div",null,[rt(j),y("section",jt,[y("div",Mt,[w[1]||(w[1]=y("h1",{class:"title"}," VRP reward per component in the Chromium project. ",-1)),y("ul",null,[y("li",null,G(B(D))+" CVEs in between "+G(B(m)[0].toISOString().split("T")[0])+" and "+G(B(m)[1].toISOString().split("T")[0]),1),y("li",null,G(B(l)(B(h)))+" total reward",1)])])]),y("section",null,[(et(),ot("svg",{width:B(I),height:B(N)},[y("g",{ref_key:"svg_labels",ref:S},null,512),y("g",{ref_key:"svg_link_labels",ref:L},null,512),y("g",{ref_key:"svg_nodes",ref:z},null,512),y("g",{ref_key:"svg_links",ref:C},null,512),w[2]||(w[2]=y("g",{class:"tooltip",style:{display:"none"}},[y("rect"),y("text")],-1))],8,Dt))]),y("section",zt,[y("div",Ct,[rt(M,{modelValue:B(m),"onUpdate:modelValue":w[0]||(w[0]=O=>vt(m)?m.value=O:null),minDate:new Date("2011-01-01")},null,8,["modelValue","minDate"])])])])}}}),Gt=_t(Vt,[["__scopeId","data-v-04e53bce"]]);export{Gt as default};
