import{_ as X}from"./K_zvSPJA.js";import{_ as Y}from"./D9tz11q0.js";import{S as Z,l as tt,q as T}from"./C4tfgTo-.js";import{t as q,s as i}from"./DkrfxnvH.js";import{f as et,g as nt,q as at,h as u,B as ot,C as rt,D as st,i as lt,o as U,c as F,b as G,a as o,t as k,j as p,v as it}from"./BJdbIX9c.js";import{f as H}from"./D2nGpDRe.js";import{p as B}from"./Drloq0xg.js";import{p as ct}from"./DKbKBQE1.js";import{_ as ut}from"./DlAUqK2U.js";import"./C7cJQd6b.js";import"./yHBgcFlJ.js";const pt={class:"section"},mt={class:"container"},dt=["width","height"],_t={class:"timeline"},ft={class:"container"},yt=et({__name:"reward_per_components",setup(ht){const b=H("$,.0f"),J=H(".2%"),y=nt(),K=at(),C=u(0),D=u(0),z=u(null),A=u(null),M=u(null),N=u(null),I=u(2e3),S=u(2e3),r=u([new Date(new Date().setDate(new Date().getDate()-365)),new Date]);y.query.start&&(r.value[0]=new Date(y.query.start)),y.query.end&&(r.value[1]=new Date(y.query.end));const Q=()=>{K.push({query:{start:r.value[0].toISOString().split("T")[0],end:r.value[1].toISOString().split("T")[0]}})},h=ot(rt);let O={};st(async()=>{O=await(await fetch("/cve/data.json")).json(),j()});const j=()=>{const c={nodes:[],links:[]},l={},d={},_=t=>(l[t]===void 0&&(l[t]=c.nodes.length,c.nodes.push({node:l[t],name:t})),l[t]),$=(t,e,n)=>{const a=`${t}-${e}`;d[a]===void 0&&(d[a]=c.links.length,c.links.push({source:t,target:e,value:0})),c.links[d[a]].value+=n};let V=0,E=0;const s={};for(const t of O){const e=new Date(t.bug_date);if(!(e<r.value[0]||e>r.value[1])){E+=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward),V+=1;for(const n of t.components||[]){let a=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward);a/=t.components.length,s[n]||(s[n]=0),s[n]+=a}}}C.value=V,D.value=E;for(const t in s)s[t]==0&&delete s[t];S.value=Math.max(500,35*Math.pow(Object.keys(s).length,.8)),I.value=window.innerWidth,Object.entries(s).sort((t,e)=>t[0].localeCompare(e[0])).forEach(([t,e])=>{const n=t.split(">");let a=_("All");s.All||(s.All=0);for(let m=0;m<n.length;m++){const f=n.slice(0,m+1).join(">");$(a,_(f),e),a=_(f)}});for(const t of c.nodes){t.component=t.name;const e=t.name.split(">");t.name=e[e.length-1]}const g=Z().nodeId(t=>t.node).nodeWidth(6).nodePadding(7).nodeAlign(tt).size([I.value-200,S.value-100]).nodeSort(null)(c),v=q().duration(500).delay(300).ease(T),w=q().duration(200).ease(T),x=q().duration(200).ease(T),R=t=>{t.attr("x",e=>e.x0).attr("y",e=>e.y0).attr("height",e=>e.y1-e.y0).attr("width",e=>e.x1-e.x0)};i(z.value).attr("transform","translate(100,50)").selectAll("rect").data(g.nodes,t=>t.component).join(t=>{const e=t.append("rect");return R(e),e.attr("fill",n=>h(n.component)).attr("opacity",0).attr("transform","translate(30,0)").transition(v).attr("opacity",1).attr("transform","translate(0,0)"),e},t=>(t=t.transition(w),R(t),t),t=>{t=t.transition(x),t.attr("opacity",0),t.remove()});const W=t=>{t.attr("d",e=>{const n=(e.target.x0-e.source.x1)*.3,a=ct();return a.moveTo(e.source.x1,e.y0-e.width/2),a.bezierCurveTo(e.source.x1+n,e.y0-e.width/2,e.target.x0-n,e.y1-e.width/2,e.target.x0,e.y1-e.width/2),a.lineTo(e.target.x0,e.y1+e.width/2),a.bezierCurveTo(e.target.x0-n,e.y1+e.width/2,e.source.x1+n,e.y0+e.width/2,e.source.x1,e.y0+e.width/2),a.closePath(),a.toString()})};i(A.value).attr("opacity",.2).attr("transform","translate(100,50)").selectAll("path").data(g.links,t=>t.source.component+t.target.name).join(t=>{const e=t.append("path");return W(e),e.attr("fill",n=>h(n.source.component)).attr("opacity",0).attr("transform","translate(30,0)").transition(v).attr("opacity",1).attr("transform","translate(0,0)"),e},t=>(t=t.transition(w),W(t),t),t=>{t=t.transition(x),t.attr("opacity",0),t.remove()}).on("mouseover",function(t,e){const[n,a]=B(t);B(t),i(this).attr("opacity",.5);const m=i(".tooltip").style("display","block").style("position","absolute").attr("transform",`translate(${n},${a})`).attr("pointer-events","none"),f=m.select("text").attr("font-size",20).attr("fill","black").attr("pointer-events","none").text(e.target.name+": "+b(e.value)+`
          (${J(e.value/D.value)})`);m.select("rect").attr("x",-10).attr("y",-30).attr("width",f.node().getBBox().width+20).attr("height",f.node().getBBox().height+20).attr("fill",h(e.source.component)).attr("rx",5).attr("ry",5).attr("pointer-events","none").attr("stroke","black").attr("stroke-width",1)}).on("mousemove",function(t){const[e,n]=B(t);i(".tooltip").attr("transform",`translate(${e},${n})`)}).on("mouseout",function(t,e){i(".tooltip").style("display","none"),i(this).attr("fill",h(e.source.component)),i(this).attr("opacity",1)});const P=t=>{t.attr("x",e=>e.x0+10).attr("y",e=>(e.y1+e.y0)/2).attr("text-anchor","start").attr("alignment-baseline","middle").text(e=>e.name).attr("font-size",e=>Math.max(Math.pow(e.y1-e.y0,.2)*5,10))};i(M.value).attr("transform","translate(100,50)").selectAll("text").data(g.nodes,t=>t.component).join(t=>{const e=t.append("text");return P(e),e.attr("opacity",0).attr("transform","translate(30,0)").transition(v).attr("opacity",1).attr("transform","translate(0,0)"),e},t=>(t=t.transition(w),P(t),t),t=>{t=t.transition(x),t.attr("opacity",0),t.remove()});const L=t=>{t.attr("transform",e=>`translate(${e.target.x0-10}, ${(e.target.y1+e.target.y0)/2})`).attr("font-size",e=>Math.max(Math.pow(e.target.y1-e.target.y0,.2)*5,10)).text(e=>b(e.value))};i(N.value).attr("transform","translate(100,50)").selectAll("text").data(g.links,t=>t.source.component+t.target.component).join(t=>{const e=t.append("text");return e.attr("text-anchor","end"),e.attr("alignment-baseline","middle"),L(e),e.attr("opacity",0).transition(v).attr("opacity",1),e},t=>(t=t.transition(w),L(t),t),t=>{t=t.transition(x),t.attr("opacity",0),t.remove()})};return lt(r,()=>{Q(),j()}),window.addEventListener("resize",()=>{j()}),(c,l)=>{const d=X,_=Y;return U(),F("div",null,[G(d),o("section",pt,[o("div",mt,[l[1]||(l[1]=o("h1",{class:"title"}," VRP reward per component in the Chromium project. ",-1)),o("ul",null,[o("li",null,k(p(C))+" CVEs in between "+k(p(r)[0].toISOString().split("T")[0])+" and "+k(p(r)[1].toISOString().split("T")[0]),1),o("li",null,k(p(b)(p(D)))+" total reward",1)])])]),o("section",null,[(U(),F("svg",{width:p(I),height:p(S)},[o("g",{ref_key:"svg_labels",ref:M},null,512),o("g",{ref_key:"svg_link_labels",ref:N},null,512),o("g",{ref_key:"svg_nodes",ref:z},null,512),o("g",{ref_key:"svg_links",ref:A},null,512),l[2]||(l[2]=o("g",{class:"tooltip",style:{display:"none"}},[o("rect"),o("text")],-1))],8,dt))]),o("section",_t,[o("div",ft,[G(_,{modelValue:p(r),"onUpdate:modelValue":l[0]||(l[0]=$=>it(r)?r.value=$:null),minDate:new Date("2011-01-01")},null,8,["modelValue","minDate"])])])])}}}),Bt=ut(yt,[["__scopeId","data-v-04e53bce"]]);export{Bt as default};
