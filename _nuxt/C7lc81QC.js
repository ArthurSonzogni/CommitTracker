import{_ as B}from"./B4jD6aij.js";import{r as $}from"./FOedhIC0.js";import{f as c}from"./D2nGpDRe.js";import{f as F,h as v,s as O,A,i as P,B as S,o as Y,p as q,j as u}from"./CIIwfncC.js";const D=F({__name:"Contributions",props:{repositories:{type:Array[String],default:()=>["chromium"]},grouping:{type:String,default:"yearly"},what:{},display:{},kind:{},percentile:{},individual:{},developers:{},min_contributions:{type:Number,default:0}},setup(L){const a=L,m=new Map;for(const t of $)m.set(t.dirname,t.color);const w=v("label"),p=O([]),b=v(c(",d")),k=function(t,o){const e=t.sort((s,i)=>i-s),r=(e.length-1)*o,n=Math.floor(r);return e[n]},C=function(t,o){const e=t.sort((r,n)=>n-r);return o<=e.length?e[o-1]:0},d=function(t,o){const e=t.sort((r,n)=>n-r);for(let r=0;r<e.length;++r)if(o>=e[r])return r+1;return e.length},f=function(t,o){for(const e in o)t[e]=(t[e]||0)+o[e]},j=function(){if(a.what=="contributors")return{label:"Contributors",graphLabel:()=>"Contributors",formatter:t=>c(",d")(t)+" 🧍",solidify:t=>{const o={};for(const e in t){const r=t[e];for(const n in r)r[n]=1;f(o,r)}return o}};if(a.what=="first_commit")return{label:"First time contributor",graphLabel:()=>"# First time contributors",formatter:t=>c(",d")(t)+" 🧍",solidify:t=>{const o={};for(const e in t){const r=Object.keys(t[e]).sort()[0];r&&(o[r]||(o[r]=0),o[r]++)}return o}};if(a.what=="last_commit")return{label:"Last time contributor",graphLabel:()=>"# Last time contributors",formatter:t=>c(",d")(t)+" 🧍",solidify:t=>{const o={};for(const e in t){const r=Object.keys(t[e]).sort().reverse()[0];r&&(o[r]||(o[r]=0),o[r]++)}return o}};if(a.what=="commit")return{label:"Commit",graphLabel:t=>t,formatter:t=>c(",d")(t)+" ⚙️",solidify:t=>{const o={};for(const e in t)f(o,t[e]);return o}};if(a.what=="per_contributor")return M();console.log("reached unreacheable code")},M=function(){const t=(o,e)=>{const r={};for(const n in o){const s=o[n]||{};for(const i in s)r[i]||(r[i]=[]),r[i].push(s[i])}for(const n in r)r[n]=e(r[n]);return r};if(a.display=="average")return{label:"Contribution",graphLabel:()=>"Commit",formatter:o=>c(".2f")(o)+" ⚙️",solidify:o=>t(o,e=>e.reduce((r,n)=>r+n,0)/e.length)};if(a.display=="percentile")return{label:"Contribution",graphLabel:()=>"Commit",formatter:o=>c(",d")(o)+" ⚙️",solidify:o=>t(o,e=>k(e,a.percentile/100))};if(a.display=="individual")return{label:"Contribution",graphLabel:o=>o=="solidified"?"Commit":o,formatter:o=>c(",d")(o)+" ⚙️",solidify:o=>t(o,e=>C(e,a.individual))};if(a.display=="someone")return{label:"Contribution",graphLabel:o=>o,formatter:o=>c(",d")(o)+" ⚙️",solidify:o=>{const e={};for(const r of a.developers)for(const n in o[r])e[n]||(e[n]=0),e[n]+=o[r][n];return e}};if(a.display=="someone_rank")return{label:"Rank",graphLabel:()=>"Rank",formatter:o=>c(",d")(o)+" 🏆",solidify:o=>{const e=t(o,s=>s),r={};for(const s of a.developers)for(const i in o[s])r[i]||(r[i]=0),r[i]+=o[s][i];const n={};for(const s in r)n[s]=r[s]==0?0:d(e[s],r[s]);return n}};if(a.display=="someone_rank_percent")return{label:"Rank (%)",graphLabel:()=>"Rank %",formatter:o=>c(".2f")(o)+"% 🏆",solidify:o=>{const e=t(o,s=>s),r={};for(const s of a.developers)for(const i in o[s])r[i]||(r[i]=0),r[i]+=o[s][i];const n={};for(const s in r)n[s]=r[s]==0?0:100*d(e[s],r[s])/e[s].length;return n}};console.log("reached unreacheable code")},h=async function(t){return await(await fetch(`/data/${t}/usernames_summary_commit_${a.grouping}_${a.kind}.json`)).json()},y=function(t){for(const o in t){let e=0;for(const r in t[o])e+=t[o][r];e<a.min_contributions&&delete t[o]}return t},g=async function(){const t=j();w.value=t.label,b.value=t.formatter;const o=t.graphLabel,e={};if(a.what=="commit"||a.what=="per_contributor"&&a.display=="someone")for(const n of a.repositories){const s=t.solidify(y(await h(n)));for(const i in s)e[i]||(e[i]=[]),e[i].push({repo:n,value:s[i]})}else{const n={};for(const i of a.repositories){const _=await h(i);for(const l in _)n[l]||(n[l]={}),f(n[l],_[l])}const s=t.solidify(y(n));for(const i in s)e[i]=[{repo:"solidified",value:s[i]}]}p.value=Object.keys(e).sort().map(n=>({label:n,values:e[n].map(s=>({label:o(s.repo),value:s.value,color:m.get(s.repo)||"gray"}))}))},R=A(()=>{switch(a.grouping){case"yearly":return"Year";case"quarterly":return"Quarter";case"monthly":return"Month"}});return P(a,g),S(g),(t,o)=>{const e=B;return Y(),q(e,{timeLabel:u(R),data:u(p),formatter:u(b)},null,8,["timeLabel","data","formatter"])}}});export{D as _};
