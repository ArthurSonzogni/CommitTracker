import{s as l}from"./DkrfxnvH.js";import{p as D}from"./DDtb2nVR.js";import{f as O,h as x,i as B,D as N,o as M,c as b,a as u}from"./BJdbIX9c.js";import{_ as T}from"./DlAUqK2U.js";const $={class:"centered"},C=O({__name:"CalendarHeatmap",props:{data:{type:Array,required:!0}},setup(z){const h=z,_=x(null),p=x(null),m=x(null),S=new Set,g=async()=>{if(!h.data.length)return;const f={};for(const t of h.data)for(const e of t.values){const a=e.x.getFullYear();f[a]||(f[a]=[]),f[a].push(e),S.add(a)}const i=[];for(const t in f){const e={},a=new Date(t,0,1),s=a.getDay();for(const o of f[t]){const n=Math.floor((o.x-a)/864e5),r=o.x.getDay(),c=Math.floor((n+s)/7);e[n]||(e[n]={x:c,y:r,z:0,date:o.x}),e[n].z+=o.y}Math.min(...Object.keys(e).map(Number)),Math.max(...Object.keys(e).map(Number)),i.push({year:t,data:Object.values(e)})}const d=200,j=i.length*d;let v=0;const y=[];for(const t of i)for(const e in t.data)y.push(t.data[e].z);y.sort((t,e)=>t-e),v=y[Math.floor(y.length*.98)];const A=D().domain([0,v+1]).range(["#eeeeee","green"]).exponent(.7),w=t=>t.attr("transform",(e,a)=>`translate(0, ${a*d})`).attr("opacity",1),k=t=>t.attr("fill",e=>A(e.z)).attr("width",16).attr("height",16).attr("opacity",1);l(_.value).attr("width",1200).attr("height",j),i.sort((t,e)=>e.year-t.year),l(m.value).selectAll("g").data(i,t=>t.year).join(t=>{const e=t.append("g");e.attr("opacity",0),e.attr("transform",(r,c)=>`translate(-300, ${c*d})`),w(e.transition().duration(300).delay((r,c)=>c*100)),e.append("text").text(r=>r.year).attr("x",0).attr("y",30).attr("font-weight","bold").attr("font-size","12px").attr("fill","black"),e.append("rect").attr("x",0).attr("y",40).attr("width",400).attr("height",d-80).attr("fill","white");const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let r=0;r<7;r++)e.append("text").text(o[r]).attr("x",0).attr("y",52+r*18).attr("font-size","12px").attr("opacity",.5);const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let r=0;r<12;r++)e.append("text").text(n[r]).attr("x",40+r*80).attr("y",30).attr("font-size","12px").attr("opacity",.5);return e},t=>w(t),t=>{t.remove()}).selectAll("rect").data(t=>t.data,t=>t.x+","+t.y).join(t=>{const e=t.append("rect");e.attr("x",(a,s)=>30+a.x*18).attr("y",(a,s)=>a.y*18+40),k(e.transition().duration(300).delay((a,s)=>s)),e.on("mouseenter",function(a,s){l(this).attr("stroke","black")}),e.on("mouseleave",function(a,s){l(this).attr("stroke","none")}),e.on("mousemove",function(a,s){l(this).node().getBoundingClientRect();let o=a.offsetX-25,n=a.offsetY+30;o=Math.floor(o/18)*18,n=Math.floor(n/18)*18,o=Math.max(o,50),o=Math.min(o,900),n=Math.max(n,50),l(p.value).attr("transform",`translate(${o}, ${n})`).attr("display","block"),l(p.value).select(".count").transition().duration(100).textTween(function(){const r=parseInt(l(this).text())||0;return c=>Math.floor(r+(s.z-r)*c)}),l(p.value).select(".date").text(s.date.toISOString().split("T")[0])})},t=>(k(t.transition().duration(300).delay((e,a)=>a)),t),t=>{t.transition().duration(300).delay((e,a)=>a).attr("opacity",0).remove()})};return B(()=>h.data,g),N(g),(f,i)=>(M(),b("div",$,[(M(),b("svg",{ref_key:"svg_ref",ref:_},[u("g",{ref_key:"svg_content_ref",ref:m},null,512),u("g",{ref_key:"tooltip_ref",ref:p,display:"none",opacity:"0.9"},i[0]||(i[0]=[u("rect",{width:"80",height:"50",fill:"#eee",rx:"10",ry:"10",stroke:"gray","stroke-width":"1"},null,-1),u("text",{class:"count",x:"10",y:"22","font-size":"20px","font-weight":"bold"}," 0 ",-1),u("text",{class:"date",x:"10",y:"42","font-size":"12px"},null,-1)]),512)],512))]))}}),H=T(C,[["__scopeId","data-v-20246c9a"]]);export{H as _};
